module Partitions

__precompile__(false)

#using Debugger

include("qplane.jl"); using .QuantumPlane

using LightGraphs, Nauty, Distributed

include("automata.jl")

using GraphViz, URIs, HTTP, OpenFST, LLLplus

include("tools.jl")

euler1 = Automaton{2}([(1,1,2),(1,2,1),(2,1,1),(1,1,3)])
euler2 = Automaton{2}([(1,1,1),(1,2,2),(2,1,1),(1,1,3)])
euler3 = Automaton{4}([(1,2,1),(1,4,2),(2,1,1),(2,2,2),(3,4,1),(3,4,2),(4,3,1),((i,i,3) for i=[1,2,3])...])
euler4 = Automaton{5}([(1,3,1),(1,5,2),(2,1,1),(2,2,2),(3,4,1),(3,2,2),(4,5,2),(5,2,1),(1,1,3),(2,2,3),(3,3,3),(4,4,3)])

Œ¥ = simplify(quantumseries(euler2,order=[2,1])-quantumseries(euler1,order=[2,1]))

kr1 = Automaton{9}([((i,1+(i%9),1) for i=1:9)...,((i,i,s) for i=[1,3,6,8], s=2:3)...])
#q1 = quantumseries(kr1,order=[2,4,5,7,9,8,3,1,6])
U‚Å∫ = inv(1-U)
q1 =  1+R*inv(1-U‚Å∫*R^2*U‚Å∫*R^3*U‚Å∫*R^2*U‚Å∫*R^2)*(1+U‚Å∫*R^2*(1+U‚Å∫*R^3*(1+U‚Å∫*R^2)))*U‚Å∫*U

kr2 = let x2v(i,j,a,b) = (3-i)*4*4*3 + (3-j)*4*3 + ((a+1)%4)*3 + (b+2)%3 + 1,
    kr2‚ÇÄ = Automaton{4*4*4*3}([((x2v(i,j,a,b),x2v(i,min(j+1,3),a,(b+1)%3),1) for i=0:3, j=0:3, a=0:3, b=0:2)...,
                                      ((x2v(i,j,a,b),x2v(j,0,b,b),s) for i=0:3, j=0:3, a=0:3, b=0:2, s=2:3 if i+j‚â•3 && (a==3 || (j‚â§1) <= ((a+b)%3 == 0)))...])
    automaton(fst(kr2‚ÇÄ) |> determinize |> minimize)
end

#q2 = quantumseries(kr2,order=[6,7,8,10,11,14,4,5,9,12,13,1,2,3])

bad_den = (-ùï¢^32 - ùï¢^30)*U^6*R^9 + (-ùï¢^27 - ùï¢^24 - ùï¢^22)*U^5*R^9 + (-ùï¢^23 - ùï¢^21)*U^5*R^6 + (-ùï¢^19)*U^4*R^9 + (-ùï¢^19 - 2*ùï¢^18 - ùï¢^16 - ùï¢^13)*U^4*R^6 + (-ùï¢^14 - ùï¢^13 - ùï¢^11 - 2*ùï¢^10 - ùï¢^8)*U^3*R^6 + (ùï¢^14 + ùï¢^12 + ùï¢^11 + ùï¢^9)*U^3*R^3 + (-ùï¢^6 - ùï¢^5)*U^2*R^6 + (ùï¢^10 + 2*ùï¢^9 + ùï¢^8 + ùï¢^7 + ùï¢^6 + ùï¢^4 + ùï¢^3)*U^2*R^3 + (ùï¢^2 + 2*ùï¢)*U*R^3 + (-ùï¢^8 - ùï¢^6)*U - 1 |> numerator

bad_num = (-ùï¢^31 - ùï¢^29)*U^6*R^9 + (-ùï¢^26)*U^5*R^9 + (ùï¢^22 + ùï¢^20)*U^5*R^8 + (-ùï¢^22 - ùï¢^20)*U^5*R^7 + (ùï¢^17)*U^4*R^8 + (-ùï¢^17)*U^4*R^7 + (-ùï¢^18 - ùï¢^16)*U^4*R^6 + (-ùï¢^15 - ùï¢^13)*U^4*R^5 + (-ùï¢^10)*U^3*R^6 + (ùï¢^12)*U^3*R^5 + (-ùï¢^12 - ùï¢^10)*U^3*R^4 + (ùï¢^4)*U^2*R^5 + (-ùï¢^4)*U^2*R^4 + (-ùï¢^8 - ùï¢^6)*U^2*R^2 - U*R^2 |> numerator

"""sols: [19,21], [18,22], [17,23], [16,24], [15,25], *[14,28], *[13,33], [12,48], ..."""

end
